<!doctype html><html lang="en"><head>
    <meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Scotty — Web Chat</title>
    <style>
    :root{--bg:#0C0D11;--panel:#121318;--line:#1E2127;--text:#E7EAF0;--muted:#A6ADBB;--red:#E11D48}
    *{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
    .wrap{max-width:900px;margin:0 auto;padding:16px}
    .card{border:1px solid var(--line);background:var(--panel);border-radius:16px;display:flex;flex-direction:column;height:86dvh}
    .header{padding:14px 16px;border-bottom:1px solid var(--line);font-weight:900;display:flex;align-items:center;justify-content:space-between}
    .chat{flex:1;overflow:auto;padding:16px}
    .msg{max-width:80%;padding:10px 12px;border-radius:12px;margin:8px 0;white-space:pre-wrap;line-height:1.5}
    .me{background:#0f1218;border:1px solid var(--line);margin-left:auto}
    .bot{background:#0b0d11;border:1px solid var(--line)}
    .input{display:flex;gap:8px;padding:12px;border-top:1px solid var(--line)}
    textarea{flex:1;resize:none;height:60px;border-radius:12px;border:1px solid var(--line);background:#0f1218;color:var(--text);padding:10px}
    button{border:0;background:var(--red);color:#111;font-weight:900;border-radius:12px;padding:0 16px}
    .small{color:var(--muted);font-size:12px}
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    </head><body>
    <div class="wrap">
      <div class="card">
        <div class="header">
          <div>Scotty (Web)</div>
          <div class="small">Be nice. No sensitive data.</div>
        </div>
        <div id="chat" class="chat"></div>
        <form id="form" class="input">
          <textarea id="t" placeholder="Ask fitment, parts, mods, etc…"></textarea>
          <button type="submit">Send</button>
        </form>
      </div>
    </div>
    <script>
    const chat = document.getElementById('chat');
    const form = document.getElementById('form');
    const t = document.getElementById('t');
    const msgs = [
      {role:"system", content:"You are Scotty, a friendly car-build assistant. Be concise, accurate, and chill. When giving numbers (offsets, widths, tire sizing), explain simply."},
    ];
    
    function push(role, text){
      const div = document.createElement('div');
      div.className = 'msg ' + (role === 'user' ? 'me' : 'bot');
      div.textContent = text;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }
    
    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const q = t.value.trim();
      if(!q) return;
      t.value = '';
      msgs.push({role:'user', content:q});
      push('user', q);
    
      const res = await fetch('/api/chat', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ messages: msgs.slice(-12) }) // keep context small
      });
      if(!res.ok){
        push('assistant', 'Error. Try again in a bit.');
        return;
      }
      const data = await res.json();
      const a = data.reply || '(no reply)';
      msgs.push({role:'assistant', content:a});
      push('assistant', a);
    });
    </script>
    </body></html>
    